I"r<h4 id="contents">Contents</h4>
<ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#externaltasksensorì˜-formatê³¼-parameter">ExternalTaskSensorì˜ Formatê³¼ Parameter</a></li>
  <li><a href="#execution_deltaì™€-execution_date_fnì˜-ì¤‘ìš”ì„±">execution_deltaì™€ execution_date_fnì˜ ì¤‘ìš”ì„±</a></li>
</ul>

<p>ë³¸ í¬ìŠ¤íŒ…ì€ ì¹´í…Œê³ ë¦¬ Airflowì˜  ExternalTaskSensorì— ê´€í•˜ì—¬ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<hr />

<h2 id="introduction"><span style="color:navy">Introduction<span></span></span></h2>

<p>ìµœê·¼ Firebaseì˜ Bigquery ë°ì´í„° ì¡°íšŒ ë¹„ìš©ì„ ê°ì†Œì‹œí‚¤ê¸° ìœ„í•´ì„œ  s3ë¡œ ì ì¬ì‹œí‚¤ê³  AWS Glueë¥¼ í†µí•´ì„œ ì£¼ê¸°ì ìœ¼ë¡œ ê´€ì¸¡í•˜ëŠ” ë°ì´í„° ì§€í‘œë¥¼ ìƒì„±í•˜ê³  ìˆìœ¼ë©°, ì´ë¥¼ Airflowë¥¼ í†µí•´ì„œ ê´€ë¦¬í•˜ê³  ìˆë‹¤. í•˜ì§€ë§Œ, Firebaseì˜ ë°ì´í„°ë¡œë¶€í„° ë¹ˆë²ˆí•˜ê²Œ ì¡°íšŒí•˜ëŠ” ì´ë²¤íŠ¸ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ì—¬ Bigqueryì—ì„œ Tableë¡œ ê´€ë¦¬í•˜ì—¬ ë°ì´í„° ì¡°íšŒ ë¹„ìš©ì„ ë” ê°ì¶•ì‹œí‚¤ê³ ì í•œë‹¤.  ì´ ê³¼ì •ì—ì„œ ìœ„ì—ì„œ ì–¸ê¸‰í•œ AIrflowì˜ Dagë‚´ íŠ¹ì • Taskë¥¼ Triggerë¡œì¨ í˜¹ì€ í•´ë‹¹ Taskì™€ ì¢…ì†ì„±ì„ ê°€ì§€ëŠ” Taskë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì‚´í´ë³´ë‹¤ê°€ <code class="language-plaintext highlighter-rouge">ExternalTaskSensor</code>ì™€  <code class="language-plaintext highlighter-rouge">TriggerDagRunOperator</code>ë¥¼ í™•ì¸í•˜ê²Œ ë˜ì—ˆë‹¤.  ì´ ì¤‘ì—ì„œ ë¨¼ì € <code class="language-plaintext highlighter-rouge">ExternalTaskSensor</code>ì— ëŒ€í•´ì„œ ë¨¼ì € ì•Œì•„ë³´ê³ ì í•œë‹¤.</p>

<p><br /></p>

<hr />

<h2 id="externaltasksensorì˜-formatê³¼-parameter"><span style="color:navy">ExternalTaskSensorì˜ Formatê³¼ Parameter<span></span></span></h2>

<p>ì•„ë˜ëŠ” <code class="language-plaintext highlighter-rouge">ExternalTaskSensor</code>ì˜ ê¸°ë³¸ í¬ë§·ê³¼ ê° íŒŒë¼ë¯¸í„°ì— ê´€í•´ì„œ ë³´ì—¬ì¤€ë‹¤.</p>

<p>(í¸ì˜ìƒ <code class="language-plaintext highlighter-rouge">ExternalTaskSensor</code>ë¥¼ ê°€ì§€ê³  ìˆëŠ” Dagë¥¼ slave dag, ê·¸ë¦¬ê³  í•´ë‹¹ sensorê°€ waitingí•˜ëŠ” Dagë¥¼ master dagë¼ê³  ë³„ì¹­í•˜ê² ë‹¤.)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">airflow.sensors.external_task</span> <span class="kn">import</span> <span class="n">ExternalTaskSensor</span>
<span class="kn">from</span> <span class="nn">airflow.utils.state</span> <span class="kn">import</span> <span class="n">State</span>

<span class="n">task</span> <span class="o">=</span> <span class="n">ExternalTaskSensor</span><span class="p">(</span><span class="s">'task_name_example'</span><span class="p">,</span>
                           <span class="n">external_dag_id</span> <span class="o">=</span> <span class="s">'master_dag_id'</span><span class="p">,</span>
                           <span class="n">external_task_id</span> <span class="o">=</span> <span class="s">'master_task_id'</span><span class="p">,</span>
                           <span class="n">allowed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="n">SKIPPED</span><span class="p">],</span>
                           <span class="n">failed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">FAILED</span><span class="p">],</span>
                           <span class="n">execution_date_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">,</span>
                           <span class="n">check_existence</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">external_dag_id</code>(<em>str</em>)
    <ul>
      <li>monitoringí•˜ëŠ” Taskë¥¼ ê°€ì§€ê³  ìˆëŠ” Dagì˜ id</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">external_task_id</code>(<em>str/default : None</em>)
    <ul>
      <li>waitingí•˜ëŠ” Taskì˜ êµ¬ì²´ì ì¸ id</li>
      <li>
        <p>ë§Œì•½ í•´ë‹¹ parameterë¥¼ ê¸°ì…í•˜ì§€ ì•Šì„ ê²½ìš° (ì¦‰, external_task_id = None)</p>

        <p>sensorëŠ” DAGë¥¼ íƒ€ê²Ÿìœ¼ë¡œ ì¡ëŠ”ë‹¤.</p>
      </li>
      <li>waitingí•˜ëŠ” taskê°€ ì—¬ëŸ¬ ê°œì¼ ê²½ìš°ì—ëŠ” <code class="language-plaintext highlighter-rouge">external_task_ids</code>(<em>Iterable</em>/<em>default : None</em>)ë¥¼ ì´ìš©í•œë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">allowed_states</code> (<em>Iterable)</em>
    <ul>
      <li>waitingì¤‘ì¸ master dagì˜ taskê°€ ì–´ë–¤ ìƒíƒœì¼ ë•Œ ì„±ê³µìœ¼ë¡œ íŒë‹¨í•˜ëŠ”ì§€ ì§€ì •í•œë‹¤.</li>
      <li>defaultëŠ” <code class="language-plaintext highlighter-rouge">[â€™successâ€™]</code>ì´ë‹¤.</li>
      <li><a href="https://airflow.apache.org/docs/apache-airflow/1.10.3/_modules/airflow/utils/state.html">stateì°¸ì¡° ë§í¬</a></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">failed_states</code> (<em>Iterable)</em>
    <ul>
      <li>waitingì¤‘ì¸ master dagì˜ taskê°€ ì–´ë–¤ ìƒíƒœì¼ ë•Œ ì‹¤íŒ¨ë¡œ íŒë‹¨í•˜ëŠ”ì§€ ì§€ì •í•œë‹¤.</li>
      <li>defaultëŠ” <code class="language-plaintext highlighter-rouge">None</code>ì´ë‹¤.</li>
      <li><a href="https://airflow.apache.org/docs/apache-airflow/1.10.3/_modules/airflow/utils/state.html">stateì°¸ì¡° ë§í¬</a></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">execution_delta</code> or <code class="language-plaintext highlighter-rouge">execution_date_fn</code>
    <ul>
      <li>
        <p>master dagì™€ <code class="language-plaintext highlighter-rouge">ExternalTaskSensor</code>Taskë¥¼ ê°€ì§„ slave dagì— ì„œë¡œ ë‹¤ë¥¸ schedule intervalì„ ì„¤ì •í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•œë‹¤.</p>

        <p>ì˜ˆë¥¼ ë“¤ì–´,  master dagì˜ scheduler intervalì´ â€œ0 16 * * <strong>*â€</strong>ì´ê³ ,</p>

        <p>slave dagì˜ intervalì´ â€œ5 16 * * *â€ ì¼ ê²½ìš°ì—ëŠ”</p>

        <p><code class="language-plaintext highlighter-rouge">execution_delta</code>ëŠ” slave dagì˜ execution_dateë¥¼ ê¸°ì¤€ìœ¼ë¡œ</p>

        <p><code class="language-plaintext highlighter-rouge">timedelta(minutes = -5)</code>ë¡œ ì„¤ì •í•˜ë©´ ëœë‹¤. ë°˜ë©´, <code class="language-plaintext highlighter-rouge">execution_date_fn</code>ì˜ ê²½ìš°  <code class="language-plaintext highlighter-rouge">lambda x : x + timedelta(minutes = -5)</code> ë¡œ ì§€ì •í•  ìˆ˜ ìˆë‹¤.</p>
      </li>
      <li>í•´ë‹¹ ë‘ íŒŒë¼ë¯¸í„°ë¥¼ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ëŠ” ì—†ë‹¤.</li>
      <li>defaultëŠ” waitingí•˜ëŠ” dagì˜ execution_dateì´ë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">check_existence</code>(<em>bool</em>)
    <ul>
      <li>Trueì¼ ê²½ìš°, waitingí•˜ê³  ìˆëŠ” dagí˜¹ì€ taskê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.</li>
      <li>ë§Œì•½ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°ì—ëŠ” ì¦‰ê°ì ìœ¼ë¡œ master taskí˜¹ì€ dagì˜ waitingì„ ì¤‘ë‹¨í•œë‹¤.</li>
      <li>ê¸°ë³¸ê°’ì€ Falseì´ë‹¤.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<hr />

<h2 id="execution_deltaì™€-execution_date_fnì˜-ì¤‘ìš”ì„±"><span style="color:navy">execution_deltaì™€ execution_date_fnì˜ ì¤‘ìš”ì„±<span></span></span></h2>

<p>ë‹¤ìŒì€ master dag code, slave dag1, ê·¸ë¦¬ê³  slave dag2ì— ëŒ€í•œ ì½”ë“œì´ë‹¤.</p>

<p>íŠ¹ì • slave dagë‚´ taskì˜ worker slotë…ì ìœ¼ë¡œ ì¸í•´ master dagì˜ task ìˆ˜í–‰ì´ ë©ˆì¶”ëŠ” ì¼€ì´ìŠ¤ë¥¼  ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ <code class="language-plaintext highlighter-rouge">mode</code>íŒŒë¼ë¯¸í„°ë¥¼ <code class="language-plaintext highlighter-rouge">reschedule</code>ë¡œ ì§€ì •í•˜ì˜€ë‹¤.</p>

<h6 id="-master_dag">&lt;/&gt; master_dag</h6>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">airflow.models</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="kn">from</span> <span class="nn">airflow.operators.dummy_operator</span> <span class="kn">import</span> <span class="n">DummyOperator</span>
<span class="kn">from</span> <span class="nn">airflow.sensors.external_task_sensor</span> <span class="kn">import</span> <span class="n">ExternalTaskMarker</span><span class="p">,</span> <span class="n">ExternalTaskSensor</span>

<span class="n">default_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'owner'</span> <span class="p">:</span> <span class="s">'zaid.ryu'</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="s">'TEST_Sensor_Master_Dag'</span><span class="p">,</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s">'Test ExternalTaskSensor Master Dag'</span><span class="p">,</span>
        <span class="n">schedule_interval</span> <span class="o">=</span> <span class="s">'0 17 * * *'</span><span class="p">,</span>
        <span class="n">default_args</span> <span class="o">=</span> <span class="n">default_args</span><span class="p">,</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span>
        <span class="n">catchup</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<span class="n">m_task1</span> <span class="o">=</span> <span class="n">DummyOperator</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span> <span class="s">'master_task1'</span><span class="p">,</span>
                        <span class="n">dag</span> <span class="o">=</span> <span class="n">dag</span><span class="p">)</span>

<span class="n">m_task2</span> <span class="o">=</span> <span class="n">DummyOperator</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span> <span class="s">'master_task2'</span><span class="p">,</span>
                        <span class="n">dag</span><span class="o">=</span> <span class="n">dag</span><span class="p">)</span>

<span class="n">m_task3</span> <span class="o">=</span> <span class="n">DummyOperator</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span> <span class="s">'master_task3'</span><span class="p">,</span>
                        <span class="n">dag</span><span class="o">=</span> <span class="n">dag</span><span class="p">)</span>

<span class="n">m_task4</span> <span class="o">=</span> <span class="n">DummyOperator</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span> <span class="s">'master_task4'</span><span class="p">,</span>
                        <span class="n">dag</span><span class="o">=</span> <span class="n">dag</span><span class="p">)</span>

<span class="n">m_task5</span> <span class="o">=</span> <span class="n">DummyOperator</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span> <span class="s">'master_task5'</span><span class="p">,</span>
                        <span class="n">dag</span><span class="o">=</span> <span class="n">dag</span><span class="p">)</span>

<span class="n">m_task1</span> <span class="o">&gt;&gt;</span> <span class="n">m_task2</span>
<span class="n">m_task1</span> <span class="o">&gt;&gt;</span> <span class="n">m_task3</span>
<span class="n">m_task3</span> <span class="o">&gt;&gt;</span> <span class="n">m_task4</span>
<span class="n">m_task3</span> <span class="o">&gt;&gt;</span> <span class="n">m_task5</span>
</code></pre></div></div>

<p><br /></p>

<h6 id="-slave_dag1">&lt;/&gt; slave_dag1</h6>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span> <span class="nn">airflow.models</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="kn">from</span> <span class="nn">airflow.operators.python_operator</span> <span class="kn">import</span> <span class="n">PythonOperator</span>
<span class="kn">from</span> <span class="nn">airflow.operators.dummy_operator</span> <span class="kn">import</span> <span class="n">DummyOperator</span>
<span class="kn">from</span> <span class="nn">airflow.sensors.external_task_sensor</span> <span class="kn">import</span> <span class="n">ExternalTaskSensor</span>
<span class="kn">from</span> <span class="nn">airflow.utils.state</span> <span class="kn">import</span> <span class="n">State</span>

<span class="n">default_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'owner'</span> <span class="p">:</span> <span class="s">'zaid.ryu'</span>
<span class="p">}</span>

<span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="s">'TEST_Sensor_Slave_Dag1'</span><span class="p">,</span>
          <span class="n">description</span> <span class="o">=</span> <span class="s">'Test ExternalTaskSensor Slave Dag1'</span><span class="p">,</span>
          <span class="n">schedule_interval</span> <span class="o">=</span> <span class="s">'5 17 * * *'</span><span class="p">,</span>
          <span class="n">default_args</span> <span class="o">=</span> <span class="n">default_args</span><span class="p">,</span>
          <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span>
          <span class="n">catchup</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<span class="n">s_task1</span> <span class="o">=</span> <span class="n">ExternalTaskSensor</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span> <span class="s">'slave_task1_sensor'</span><span class="p">,</span>
                             <span class="n">external_dag_id</span> <span class="o">=</span> <span class="s">'TEST_Sensor_Master_Dag'</span><span class="p">,</span>
                             <span class="n">external_task_id</span> <span class="o">=</span> <span class="s">'master_task2'</span><span class="p">,</span>
                             <span class="n">allowed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="n">SKIPPED</span><span class="p">],</span>
                             <span class="n">failed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">FAILED</span><span class="p">],</span>
                             <span class="n">check_existence</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                             <span class="n">execution_date_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dt</span> <span class="p">:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">),</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s">'reschedule'</span><span class="p">,</span>
                             <span class="c1">#timeout=3600,
</span>                             <span class="n">dag</span> <span class="o">=</span> <span class="n">dag</span><span class="p">)</span>

<span class="n">s_task2</span> <span class="o">=</span> <span class="n">ExternalTaskSensor</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span> <span class="s">'slave_task2_sensor'</span><span class="p">,</span>
                             <span class="n">external_dag_id</span> <span class="o">=</span> <span class="s">'TEST_Sensor_Master_Dag'</span><span class="p">,</span>
                             <span class="n">external_task_id</span> <span class="o">=</span> <span class="s">'master_task2'</span><span class="p">,</span>
                             <span class="n">allowed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="n">SKIPPED</span><span class="p">],</span>
                             <span class="n">failed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">FAILED</span><span class="p">],</span>
                             <span class="n">check_existence</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                             <span class="n">execution_date_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dt</span> <span class="p">:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s">'reschedule'</span><span class="p">,</span>
                             <span class="c1">#timeout=3600,
</span>                             <span class="n">dag</span> <span class="o">=</span> <span class="n">dag</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<h6 id="-slave_dag2">&lt;/&gt; slave_dag2</h6>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span> <span class="nn">airflow.models</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="kn">from</span> <span class="nn">airflow.operators.python_operator</span> <span class="kn">import</span> <span class="n">PythonOperator</span>
<span class="kn">from</span> <span class="nn">airflow.operators.dummy_operator</span> <span class="kn">import</span> <span class="n">DummyOperator</span>
<span class="kn">from</span> <span class="nn">airflow.sensors.external_task_sensor</span> <span class="kn">import</span> <span class="n">ExternalTaskSensor</span>
<span class="kn">from</span> <span class="nn">airflow.utils.state</span> <span class="kn">import</span> <span class="n">State</span>

<span class="n">default_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'owner'</span> <span class="p">:</span> <span class="s">'zaid.ryu'</span>
<span class="p">}</span>

<span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="s">'TEST_Sensor_Slave_Dag1'</span><span class="p">,</span>
          <span class="n">description</span> <span class="o">=</span> <span class="s">'Test ExternalTaskSensor Slave Dag1'</span><span class="p">,</span>
          <span class="n">schedule_interval</span> <span class="o">=</span> <span class="s">'5 17 * * *'</span><span class="p">,</span>
          <span class="n">default_args</span> <span class="o">=</span> <span class="n">default_args</span><span class="p">,</span>
          <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">),</span>
          <span class="n">catchup</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

<span class="n">s_task1</span> <span class="o">=</span> <span class="n">ExternalTaskSensor</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span> <span class="s">'slave_task1_sensor'</span><span class="p">,</span>
                             <span class="n">external_dag_id</span> <span class="o">=</span> <span class="s">'TEST_Sensor_Master_Dag'</span><span class="p">,</span>
                             <span class="n">external_task_id</span> <span class="o">=</span> <span class="s">'master_task2'</span><span class="p">,</span>
                             <span class="n">allowed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="n">SKIPPED</span><span class="p">],</span>
                             <span class="n">failed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">FAILED</span><span class="p">],</span>
                             <span class="n">check_existence</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                             <span class="n">execution_date_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dt</span> <span class="p">:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">),</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s">'reschedule'</span><span class="p">,</span>
                             <span class="c1">#timeout=3600,
</span>                             <span class="n">dag</span> <span class="o">=</span> <span class="n">dag</span><span class="p">)</span>

<span class="n">s_task2</span> <span class="o">=</span> <span class="n">ExternalTaskSensor</span><span class="p">(</span><span class="n">task_id</span> <span class="o">=</span> <span class="s">'slave_task2_sensor'</span><span class="p">,</span>
                             <span class="n">external_dag_id</span> <span class="o">=</span> <span class="s">'TEST_Sensor_Master_Dag'</span><span class="p">,</span>
                             <span class="n">external_task_id</span> <span class="o">=</span> <span class="s">'master_task2'</span><span class="p">,</span>
                             <span class="n">allowed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">SUCCESS</span><span class="p">,</span> <span class="n">State</span><span class="p">.</span><span class="n">SKIPPED</span><span class="p">],</span>
                             <span class="n">failed_states</span> <span class="o">=</span> <span class="p">[</span><span class="n">State</span><span class="p">.</span><span class="n">FAILED</span><span class="p">],</span>
                             <span class="n">check_existence</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                             <span class="n">execution_date_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dt</span> <span class="p">:</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s">'reschedule'</span><span class="p">,</span>
                             <span class="c1">#timeout=3600,
</span>                             <span class="n">dag</span> <span class="o">=</span> <span class="n">dag</span><span class="p">)</span>
</code></pre></div></div>

<p><br /></p>

<p>ê·¸ë¦¬ê³  ì´ë¥¼ ë„ì‹í™”í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<p>(í¸ì˜ìƒ ê¸€ì„ ì“¸ ë•ŒëŠ” TEST_Master_Dagë¥¼ master dag, TEST_Sensor_Slave_Dag1ê³¼ 2ë¥¼ slave dag1, slave dag2ë¼ê³  ì§€ì¹­í•˜ê² ë‹¤.)</p>

<p><img src="https://user-images.githubusercontent.com/53929665/154834362-5813162c-aaed-44fb-9e58-62c735939da8.png" alt="Untitled" /></p>

<p>master dagì˜ master task2ê°€ ì™„ë£Œ(successìƒíƒœ)ë˜ë©´  slave dag1ì˜ slave_task1_sensorì™€ slave_task2_sensorì˜ <code class="language-plaintext highlighter-rouge">reschedule</code>ìƒíƒœê°€ <code class="language-plaintext highlighter-rouge">running</code>ìƒíƒœë¡œ ë³€ê²½ë˜ë©´ì„œ slave dag1ì˜ taskë“¤ì´ ìˆ˜í–‰ëœë‹¤.</p>

<p>ì´ë•Œ, master dagì™€ slave dag1ì˜ <code class="language-plaintext highlighter-rouge">schedule_interval</code>ì˜ ì°¨ì´ê°€ 5ë¶„ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì´ë•Œ, í•´ë‹¹ slave dagì˜  ê²½ìš° <code class="language-plaintext highlighter-rouge">execution_date_fn</code>í˜¹ì€ <code class="language-plaintext highlighter-rouge">execution_delta</code>ë¥¼ 5ë¶„ìœ¼ë¡œ ì§€ì •í•  í•„ìš”ê°€ ìˆë‹¤.</p>

<p>slave_task1_sensorì˜ ê²½ìš°ì—ëŠ” ìœ„ì™€ ê°™ì´ ì§€ì • ë˜ì—ˆì§€ë§Œ, slave_task2_sensorì˜ ê²½ìš°ì—ëŠ” 3ë¶„ìœ¼ë¡œ ì§€ì •í•˜ì˜€ë‹¤. (í•´ë‹¹ taskëŠ” ë¬¸ì œë¥¼ ë°œìƒì‹œí‚¬ ê²ƒì´ë‹¤.)</p>

<p>ê·¸ë¦¬ê³ , master dagì˜ master task1ì´ ì™„ë£Œë˜ë©´ slave dag2ì˜ slave_task1_sensorê°€, master task5ê°€ ì™„ë£Œë˜ë©´ slave_task2_sensorê°€  <code class="language-plaintext highlighter-rouge">reschedule</code>ìƒíƒœê°€ <code class="language-plaintext highlighter-rouge">running</code>ìƒíƒœë¡œ ë³€ê²½ë  ê²ƒì´ë‹¤.</p>

<p>ì´ë•Œ, master dagì™€ slave dag2ì˜ <code class="language-plaintext highlighter-rouge">schedule_interval</code>ì´ ë™ì¼í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  ë”°ë¼ì„œ, í•´ë‹¹ slave dagì˜ ê²½ìš° <code class="language-plaintext highlighter-rouge">execution_date_fn</code>í˜¹ì€ <code class="language-plaintext highlighter-rouge">execution_delta</code>ë¥¼ 0ë¶„ìœ¼ë¡œ ì§€ì •í•  í•„ìš”ê°€ ìˆë‹¤.</p>

<p>ê·¸ë¦¬ê³ , slave dag2ì˜ slave_task1_sensorì™€ slave_task2_sensorë¥¼ ìœ„ì™€ ê°™ì´ ì§€ì •í•˜ì˜€ë‹¤.</p>

<p><br /></p>

<p>ì´ì œ dagë¥¼ ìˆ˜í–‰í•œ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì.</p>

<p><img src="https://user-images.githubusercontent.com/53929665/154834358-f2d53466-1b3c-46a9-8cc2-ce77016dc88b.png" alt="Untitled 1" /></p>

<p>master dagì˜ ëª¨ë“  taskë“¤ì€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. ë”ë¶ˆì–´, slave dag2ì˜ slave_task2_sensorë¥¼ ì œì™¸í•œ ëª¨ë“  <code class="language-plaintext highlighter-rouge">ExternalTaskSensor</code>ê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•œ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p>í•´ë‹¹ taskë§Œ ì‹¤íŒ¨í•œ ì´ìœ ëŠ” ìœ„ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´  <code class="language-plaintext highlighter-rouge">execution_date_fn</code>í˜¹ì€ <code class="language-plaintext highlighter-rouge">execution_delta</code>ë¥¼ ì˜ëª» ì§€ì •í•˜ì˜€ê¸° ë•Œë¬¸ì´ë‹¤. ì™œëƒí•˜ë©´, í•´ë‹¹ taskì˜ ê²½ìš° timedelta(minutes = -2)ë¡œ ì§€ì •í•˜ì˜€ê¸° ë•Œë¬¸ì— slave dag2ì˜ <code class="language-plaintext highlighter-rouge">schedule_interval = â€˜5 17 * * *â€™</code>ì„ ê¸°ì¤€ìœ¼ë¡œ <strong>2022-02-18T17:03:00+00.00</strong>ì— ì‹¤í–‰ë˜ëŠ” taskë¥¼ 1ë¶„ ê°„ê²©ìœ¼ë¡œ í™•ì¸í•˜ë©° waitingí•˜ê²Œ ëœë‹¤. í•˜ì§€ë§Œ, ë„ì‹ì—ì„œë„ ë³¼ ìˆ˜ ìˆë“¯ì´ ê·¸ëŸ° taskëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<p><br /></p>

<p><img src="https://user-images.githubusercontent.com/53929665/154834361-5f29ebd3-44be-4cb9-9d95-ca53b3c13c5d.png" alt="Untitled 2" /></p>

<p>ë”°ë¼ì„œ, í•´ë‹¹ taskëŠ” ìœ„ì˜ ì‚¬ì§„ì²˜ëŸ¼ ì™„ë£Œ ìƒíƒœì˜ master_task2ë¥¼ ë¬´í•œì •ìœ¼ë¡œ waitingí•˜ê²Œ ëœë‹¤. ì´ëŸ¬í•œ ë¬´í•œì • waitingì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ <code class="language-plaintext highlighter-rouge">ExternalTaskSensor</code>ë‚´ì— <code class="language-plaintext highlighter-rouge">timeout</code>íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì •í•  ìˆ˜ ìˆê¸´ í•˜ì§€ë§Œ, ì´ëŸ° ìƒí™©ì„ ë°œìƒí•˜ì§€ ì•Šë„ë¡ <code class="language-plaintext highlighter-rouge">execution_date_fn</code>í˜¹ì€ <code class="language-plaintext highlighter-rouge">execution_delta</code>ë¥¼ ì œëŒ€ë¡œ ì§€ì •í•´ì£¼ëŠ” ê²ƒì´ ì¤‘ìš”í•œ ê²ƒ ê°™ë‹¤.</p>

<p><br /></p>

<hr />

<h2 id="references"><span style="color:navy">References<span></span></span></h2>

<ul>
  <li><a href="https://www.cloudwalker.io/2021/09/26/airflow-external-task-sensor/">Cloud Walkerâ€™s Airflow - External Task Sensor posting</a></li>
  <li><a href="https://airflow.apache.org/docs/apache-airflow/stable/_api/airflow/sensors/external_task/index.html">Airflow Operators Documents</a></li>
  <li><a href="https://guptakumartanuj.wordpress.com/category/airflow/">Airflow Sensor Mode</a></li>
</ul>
:ET